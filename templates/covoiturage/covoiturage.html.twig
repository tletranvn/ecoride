{% extends 'base.html.twig' %}

{% block title %}Mon espace covoiturage - EcoRide{% endblock %}

{% block body %}
<div class="d-flex flex-column min-vh-100">
    <main class="container flex-grow-1 mt-5">

        <h1 class="text-center mb-4">Bienvenue dans votre espace <strong>Covoiturage</strong></h1>

        <!-- Choix de userType -->
        {% if app.user.userType %}
            <div class="alert alert-info text-center">
                Vous √™tes <strong>{{ app.user.userType|capitalize }}</strong>
                <a href="{{ path('app_choix_profil') }}" class="btn btn-sm btn-outline-dark ms-3">Modifier mon r√¥le</a>
            </div>
        {% else %}
            <div class="alert alert-warning text-center">
                Aucun r√¥le s√©lectionn√©. 
                <a href="{{ path('app_choix_profil') }}" class="btn btn-sm btn-warning ms-3">Choisir mon profil</a>
            </div>
        {% endif %}

        <!-- Message de bienvenue 
        {% if app.user %}
            <div class="alert alert-success text-center">
                Bonjour {{ app.user.pseudo }} ‚Äì Vous avez {{ app.user.credits }} cr√©dits.
            </div>
        {% endif %} -->

        <!-- Voir mes cr√©dits restants -->
        <div class="text-end mb-3">
            <span class="badge bg-success fs-6">
                üí≥ Cr√©dits restants : <strong>{{ user.credits|number_format(2, '.', ' ') }}</strong>
            </span>
        </div>

        <!-- Trajets r√©serv√©s -->
        <section class="mb-5">
            <h2>Mes trajets r√©serv√©s</h2>
            {% if participation is not empty %}
                <ul class="list-group">
                    {% for p in participation %}
                        {% set trajet = p.trajet %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ trajet.villeDepart }} ‚Üí {{ trajet.villeArrivee }}</strong><br>
                                {{ trajet.dateDepart|date('d/m/Y H:i') }} ‚Äì 
                                Chauffeur : {{ trajet.chauffeur.pseudo }} ‚Äì 
                                Cr√©dits utilis√©s : {{ p.creditsUtilises }}
                            </div>
                            <div class="d-flex justify-content-end align-items-center gap-2">
                                <a href="{{ path('trajet_detail', { id: trajet.id }) }}" class="btn btn-sm btn-outline-primary me-2">Voir le d√©tail</a>

                                <form action="{{ path('trajet_annuler_participation', { id: trajet.id }) }}" method="post" onsubmit="return confirm('Confirmer l‚Äôannulation ?')" style="display:inline;">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete_participation' ~ trajet.id) }}">
                                    <button class="btn btn-sm btn-outline-danger">Annuler</button>
                                </form>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Aucune r√©servation en cours.</p>
            {% endif %}
            <br>
            <a href="{{ path('mes_validations') }}" class="btn btn-ecoride btn-ecoride-secondary me-2">
                Voir mes trajets √† valider
            </a>
        </section>
        

        {% if app.user.userType != 'passager' %}

        <!-- Trajets propos√©s -->
        <section class="mb-5">
            <h2>Mes trajets propos√©s</h2>
            {% if trajetsProposes is not empty %}
                <ul class="list-group">
                    {% for trajet in trajetsProposes %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ trajet.villeDepart }} ‚Üí {{ trajet.villeArrivee }}</strong><br>
                                {{ trajet.dateDepart|date('d/m/Y H:i') }} ‚Äì {{ trajet.placesRestantes }}/{{ trajet.placesTotal }} places restantes<br>      
                            </div>
                            <div class="d-flex justify-content-end align-items-center gap-2">
                                <a href="{{ path('app_espace_trajet_detail', {'id': trajet.id}) }}" class="btn btn-sm btn-outline-primary">Voir le d√©tail</a>

                                <form method="post" action="{{ path('app_espace_trajet_annuler', {'id': trajet.id}) }}" onsubmit="return confirm('Annuler ce trajet ?');">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ trajet.id) }}">
                                    <button class="btn btn-sm btn-outline-danger">Annuler</button>
                                </form>
                            </div>
                        </li>
                    {% endfor %}

                </ul>
            {% else %}
                <p>Vous n‚Äôavez propos√© aucun trajet.</p>
            {% endif %}
            <br>
            <a href="{{ path('app_espace_trajet_new') }}" class="btn btn-ecoride btn-ecoride-secondary me-2">+ Cr√©er un trajet</a>
        </section>

        <!-- V√©hicules -->
        <section class="mb-5">
            <h2>Mes v√©hicules</h2>
            {% if vehicules is not empty %}
                <ul class="list-group">
                    {% for v in vehicules %}
                        <li class="list-group-item">
                            {{ v.marque }} {{ v.modele }} ‚Äì {{ v.typeEnergie|capitalize }}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Aucun v√©hicule enregistr√©.</p>
            {% endif %}
            <br>
            <a href="{{ path('app_vehicule_new') }}" class="btn btn-ecoride btn-ecoride-secondary me-2">+ Ajouter un v√©hicule</a>
        </section>
            
        {% endif %}
    </main>
</div>
{% endblock %}
